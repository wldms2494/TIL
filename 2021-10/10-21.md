ì¢‹ì•„ìš” ê¸°ëŠ¥ ì¶”ê°€í•˜ê¸°ğŸ™†ğŸ‘	ï¸
=================


![img_9.png](img_9.png)

1.í…Œì´ë¸” ì—°ê´€ê´€ê³„ ì‚´í”¼ê¸°
==========================
í…Œì´ë¸” ê°„ì˜ ì—°ê´€ê´€ê³„ë¥¼ ë¨¼ì € ì‚´í´ë³´ì•„ì•¼ í•œë‹¤.  
ì´ê²Œ ì‚¬ì‹¤ ì •ë‹µì´ë¼ê³  ë”± ì´ì•¼ê¸° ë˜ëŠ”ê²ƒì´ë¼ê¸° ë³´ë‹¤ ìƒê°ì„ í•´ì•¼í•˜ëŠ” ê³¼ì •ì´ê¸°ì— ì˜¤ë¥˜ë¥¼ ë²”í•˜ê¸°ê°€ ì‰½ë‹¤.  
í•˜ë‚˜ì˜ íšŒì›ì€ ì—¬ëŸ¬ê°œì˜ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¼ìˆ˜ ìˆë‹¤.  
ì´ê²ƒì€ í•˜ë‚˜ì˜ ê²Œì‹œë¬¼ì— ì¢‹ì•„ìš”ë¥¼ ì—¬ëŸ¬ë²ˆ ëˆ„ë¥¸ë‹¤ëŠ” ë§ì´ ì•„ë‹ˆë‹¤.

ìš°ë¦¬ê°€ ë§ˆì´í˜ì´ì§€ì—ì„œ ë‚´ê°€ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ ê²Œì‹œê¸€ì„ ëª¨ì•„ ë³¼ìˆ˜ ìˆë‹¤ê³  ìƒê° í•´ë³´ì.

ê·¸ë˜ì„œ ë‚˜ëŠ”íšŒì›ê³¼ ì¢‹ì•„ìš”ì˜ ê´€ê³„ë¥¼ "1:ë‹¤"ì˜ ê´€ê³„ë¥¼ ë§ºì–´ì¤¬ë‹¤.

ì²˜ìŒì—ëŠ” ì•„ì˜ˆ ìœ ì €ì™€ì˜ ì—°ê´€ê´€ê³„ë¥¼ ë¹¼ê³  ì‹¶ì—ˆìœ¼ë‚˜.. ì˜ˆì™¸ì²˜ë¦¬ê³¼ì •ì—ì„œ íšŒì›ì„ ì•ˆë„£ì„ìˆ˜ê°€ ì—†ì—ˆë‹¤.(ì´ìœ ê°€ ê¸°ì–µì•ˆë‚¨)

Likeì™€ Postì˜ ê´€ê³„ë„ ìƒê° í•´ë³´ì.  
í•˜ë‚˜ì˜ í¬ìŠ¤íŠ¸ëŠ” ì—¬ëŸ¬ê°œì˜ ì¢‹ì•„ìš”ë¥¼ ë°›ì„ ìˆ˜ ìˆë‹¤
ì¢‹ì•„ìš”ëŠ” ë”°ë¡œ ì»¬ëŸ¼ì„ ì¶”ê°€ í• ê²ƒì´ ì—†ê³ , ì¢‹ì•„ìš” id, í¬ìŠ¤íŠ¸id, íšŒì›ë²ˆí˜¸idë¥¼ ê°€ì§€ëŠ” í…Œì´ë¸”ì´ ì™„ì„±ë˜ì—ˆë‹¤.  
ê·¸ë¦¼ì—ëŠ” ë¹ ì ¸ìˆì§€ë§Œ, í¬ìŠ¤íŠ¸ì— ì¢‹ì•„ìš” ê°¯ìˆ˜ë¥¼ ë„£ì–´ ì£¼ê¸° ìœ„í•´,  
`
@Column
private int heartNum;
`
ë„ ì„¤ì • í•´ì£¼ì—ˆë‹¤.


+) likeë¼ëŠ” ì´ë¦„ì„ ì“°ë‹ˆ queryë¬¸ì— likeê°€ ìˆì–´ì„œ ì˜¤ë¥˜ê°€ ë‚  ìˆ˜ ë„ ìˆë‹¤ê³  ì°¾ì•˜ë‹¤
ê·¸ë˜ì„œ heartë¡œ ëª¨ë‘ ë°”ê¿” ì£¼ì—ˆê³ , idì—­ì‹œ ì›ë˜ëŠ” `postId`, `userId`ë¡œ ì¼ì§€ë§Œ ,   
ì´ ì—­ì‹œ `findByPostIdAndUserId` ë‚ ë¦´ë•Œ Idê°€ ì›ë˜ ì†Œë¬¸ìì—ì„œ ëŒ€ë¬¸ìê°€ ë˜ëŠ” í˜•ì‹ì¸ë°,,   
íƒœì´ˆë¶€í„° Idë¼ê³  ë˜ìˆì–´ì„œ ê·¸ëŸ°ê°€... ê³„ì™ 

![img_10.png](img_10.png)
ì´ë ‡ê²Œ ì˜¤ë¥˜ê°€ ë‚˜ëŠ”ê²ƒì´ ì•„ë‹Œê°€..  
ê·¸ë˜ì„œ ë‚˜ë„ ì™¸ë˜í‚¤ ë³€ìˆ˜ëª…ì„ ëª¨ë‘ idë¡œ ë°”ê¿”ë²„ë¦¬ë‹ˆ í•´ê²°ë˜ì—ˆë‹¤ ã…‹

2.Dto í´ë¼ì´ì–¸íŠ¸ìª½ì—ì„œ ë“¤ê³ ì˜¬ê²ƒ ì‚´í”¼ê¸°
==============================
ê¸°ëŠ¥ì„ ì„¤ê³„í• ë•ŒëŠ” Entity ì´í›„ì— Dtoë¥¼ ì„¤ê³„í•˜ì§€ë§Œ,  
ì´ë²ˆ ì¢‹ì•„ìš” ê¸°ëŠ¥ì€ ë”°ë¡œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ê°€ì ¸ì˜¤ëŠ”ê²ƒì´ ì—†ê¸° ë•Œë¬¸ì—
pass~~


3.ğŸ¤¢Service ì„¤ê³„í•˜ê¸°ğŸ¤¢
==============================
```java

import com.sparta.backend.domain.Heart;
import com.sparta.backend.domain.Post;
import com.sparta.backend.domain.User;

import com.sparta.backend.repository.HeartRepository;
import com.sparta.backend.repository.PostRepository;
import com.sparta.backend.repository.UserRepository;
import com.sparta.backend.security.UserDetailsImpl;
import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;


import javax.transaction.Transactional;

@RequiredArgsConstructor
@Service
public class HeartService {

    private final PostRepository postRepository;
    private final HeartRepository heartRepository;
    private final UserRepository userRepository;
    
    @Transactional
    //ì¢‹ì•„ìš”ì˜ ìœ ë¬´ëŠ” 'liked'ì˜ true ì™€ falseë¡œ íŒë‹¨í•œë‹¤.
    public boolean liked(Long postId, UserDetailsImpl userDetails){//í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë”°ë¡œ ë“¤ê³ ì˜¤ëŠ” ë‚´ìš©ì´ ì—†ë‹¤. requestDtoì—†ìŒ
        //userDetailsë¡œ íšŒì›ë²ˆí˜¸ ê°€ì ¸ì™€ì„œ userê°ì²´ ìƒì„±í•˜ê¸° 
        User user = userRepository.findById(userDetails.getUser().getId()).orElseThrow(
                () -> new IllegalArgumentException("ìœ ì €ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        );
        //postIdë¡œ postRepositoryë’¤ì ¸ì„œ postê°ì²´ ìƒì„±í•˜ê¹…
        Post post = postRepository.findById(postId).orElseThrow(
                () -> new IllegalArgumentException("ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.")
        );
            //postIdì™€ userIdë¡œ heartê°ì²´ ìƒì„±í•˜ê¸°
            //.orElse(null) : ìˆëŠ” ê²½ìš° ê°’ì„ ë°˜í™˜í•˜ê³  , ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ nullì„ ë°˜í™˜í•œë‹¤.
            //ìš°ë¦¬ê°€ ê²Œì‹œê¸€ì— ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì§€ ì•Šì€ ìƒíƒœë¼ë©´, heartë¼ëŠ” ê°ì²´ê°€ ìš°ë¦¬ ì•„ì´ë””ë¡œ ì—†ê² ì§€, ? ê·¸ë˜ì†Œ nullë¡œ ì„¤ì •ì´ ëœë‹¤.
        Heart heart =heartRepository.findByPostIdAndUserId(post.getId(), user.getId()).orElse(null);
           //ì´ë¶€ë¶„ì´ ì¢€ ì–´ë ¤ìš¸ìˆ˜ ìˆìŒ
            //heartê°€ nullì´ë¼ë©´ í•˜íŠ¸ê°€ ë¹ˆí•˜íŠ¸ë¼ë©´  ë‚´ê°€ í•´ì¤„ìˆ˜ ìˆëŠ” ë™ì‘ì€ addë°–ì— ì—†ê²Œ ë§Œë“¤ì–´ë²„ë¦¼.
            //ì´ë¯¸ ê½‰ì°¬í•˜íŠ¸(ì¢‹ì•„ìš” ëˆ„ë¥¸ ìƒíƒœ)ì¸ë°, ë‹¤ì‹œ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¼ìˆœ ì—†ì§€ ì•ŠëŠ”ê°€.
            //ì´ë¯¸ ê°’ì´ nullì¸ë°, delete heartí• ê²ƒë„ ì—†ìŒ
        if(heart ==null) {
                //í•˜íŠ¸ê°€ ë¹ˆí•˜íŠ¸ë¼ë©´, postì™€ userë¥¼ ë„£ì€ ìƒˆë¡œì€ heartë¥¼ ë§Œë“¤ì–´ì„œ ê°ì²´ë¥¼ ì €ì¥í•œë‹¤.
            heart =  heartRepository.save(new Heart(post, user));
            //ê°ì²´ëŠ” user í…Œì´ë¸”ì—ë„ addë˜ê³ 
            //postí…Œì´ë¸”ì—ë„ addëœë‹¤.
            //ì´ ê°’ì„ trueë¡œ ë°˜í™˜í•˜ê³ , trueê°€ ë¬ë‹¤ëŠ” ë§ì€ ì¦‰ ì¢‹ì•„ìš” ë¥¼ í•´ì£¼ì—ˆë‹¤ëŠ” ë§ì„;;_;; ì¢€ ì˜ì§ ë“¯ ìŠ¹ì¤€ë‹˜ ê°ì‚¬í•´ì—¬
            user.addHeart(heart);
            post.addHeart(heart);
        return true;
        }
        else {
            //í•˜íŠ¸ê°€ null ì´ ì•„ë‹ˆë¼ë©´,
            //userì— ìˆë˜ í•˜íŠ¸ ê°’ì„ í•œê°œ ë¹¼ì¤€ë‹¤.
            //postì—ì„œë„ ë¹¼ì¤€ë‹¤.
            //falseë¼ëŠ” ë§ì€ ì¦‰ ì¢‹ì•„ìš”ë¥¼ í•˜ë‚˜ ì·¨ì†Œ í•´ì¤€ê²ƒì„
            user.deleteHeart(heart);
            post.deleteHeart(heart);
            heartRepository.delete(heart);
            return false;
        }
    }
}
```
4.Repositoryì„¤ê³„í•˜ê¸°
======================
Serviceë¥¼ ì„¤ê³„í•˜ë‹¤ê°€ ë³´ë©´, ë ˆíŒŒì§€í† ë¦¬ì—ì„œ ê°ì²´ë¥¼ ë¶ˆëŸ¬ ì™€ì•¼ í•˜ê¸° ë•Œë¬¸ì—  
findByPostIdAndUserIdë¥¼ ìœ„í•´ repoë¥¼ ë§Œë“¤ì–´ ì¤€ë‹¤.
findAll, findById ìš”ëŸ°ê²ƒë“¤ì€ ë”°ë¡œ ì„¤ì •í•´ì£¼ì§€ ì•Šì•„ë„ ì“¸ìˆ˜ ìˆì§€ë§Œ,
íŠ¹ì •í•œ idë¡œ ì°¾ëŠ” ê²½ìš°ì—ëŠ”
ì¿¼ë¦¬ë¬¸ì„ ë§Œë“¤ì–´ ì£¼ì–´ì•¼ í•œë‹¤.
```java

import com.sparta.backend.domain.Heart;
import org.springframework.data.jpa.repository.JpaRepository;

import java.util.Optional;

public interface HeartRepository extends JpaRepository <Heart,Long> {


    Optional<Heart> findByPostIdAndUserId(Long postId, Long userId);
    //heartë¼ëŠ” ë¦¬ìŠ¤íŠ¸ë¥¼ postIdì™€ userIdë¥¼ í†µí•´ ë’¤ì§€ëŠ” ë¬¸êµ¬

}

```
5.Controllerì„¤ê³„í•˜ê¸°
====================

```java
@RestController
@RequiredArgsConstructor
public class HeartController {
    private final HeartService heartService;

    @PostMapping("/posts/{postId}/like")
    //@PathVariableì„ í†µí•´ , URLì„ íƒ€ê³ ì˜¨ postIdë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    //@AutneticationPrincipalì„ í†µí•´ ë¡œê·¸ì¸ëœ ì‚¬ìš©ìì˜ userDetailsImplì„ ê°€ì ¸ì˜¨ë‹¤ ã…‹
    //ì—¬ê¸° ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì£¼ëª©í•  ì ì€, í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë”°ë¡œ request ìš”ì²­í•˜ëŠ” ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ê²Œ ì—†ë‹¤ëŠ”ì  !requestDtoê°€ ì—†ë‹¤ëŠ” ì !
    
        public String likePost(@PathVariable Long postId, @AuthenticationPrincipal UserDetailsImpl userDetails) {
        
        //liked ì¦‰ ì¢‹ì•„ìš” ëëŠ”ì§€ëŠ” true ì™€ falseë¡œ êµ¬ë¶„í•œë‹¤.
        //likedë¼ëŠ” ë³€ìˆ˜ëŠ” boolean ìë£Œí˜•ì„ ê°€ì§.
        
        boolean liked = heartService.liked(postId, userDetails);
        if (liked) {
            return "true";
        } else {
            return "false";
        }
    }
}
```
íì•„ í˜ë“¤ë‹¤.;_;

ì´í‹€ ë™ì•ˆ ë¶™ì¡ê³  ìˆë˜ ë‚˜ì˜ ì¢‹ì•„ìš”..
ì•„ì§ ë¶€ì¡±í•œ ë¶€ë¶„ë„ ë¶„ëª…íˆ ì¡´ì¬í•œë‹¤ëŠ” ì . 